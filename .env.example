# ─── Docker Compose (local dev) ──────────────────
POSTGRES_USER=playbook         # Postgres user for docker-compose
POSTGRES_PASSWORD=             # Postgres password for docker-compose
POSTGRES_DB=playbook           # Postgres database name

# ─── LiteLLM Service (Railway) ────────────────────
ANTHROPIC_API_KEY=             # Claude models
OPENAI_API_KEY=                # GPT models
OPENROUTER_API_KEY=            # Mercury via OpenRouter (§20)
LITELLM_MASTER_KEY=            # Admin access to LiteLLM proxy
LANGFUSE_PUBLIC_KEY=           # LLM observability (§18)
LANGFUSE_SECRET_KEY=           #
LANGFUSE_HOST=                 # e.g. https://cloud.langfuse.com
REDIS_HOST=                    # Default: uses REDIS_URL instead. Only needed for LiteLLM standalone
REDIS_PORT=                    # Default: 6379. Only needed for LiteLLM standalone
REDIS_PASSWORD=                # Required for docker-compose. In prod, included in REDIS_URL

# ─── API Service (Railway) ────────────────────────
DATABASE_URL=                  # PostgreSQL + pgvector (§16, §21)
REDIS_URL=                     # Token rate limiting (§18)
SENTRY_DSN=                    # Error tracking (§12)
TURNSTILE_SECRET_KEY=          # Bot protection (§18 Denial-of-Wallet)
AUTH_MODE=strict               # 'strict' (default) requires auth, 'open' disables auth (dev only)
AUTH_ALLOW_OPEN_IN_PRODUCTION= # Break-glass: set to 'true' to allow AUTH_MODE=open in production (dangerous)
API_KEYS=                      # Valid API keys, comma-separated
API_INTERNAL_KEY=              # Internal key for web/admin frontends (generate: openssl rand -hex 32)
ADMIN_API_KEY=                 # Admin endpoint auth (prompts, composio, etc.)
ALLOWED_ORIGINS=               # REQUIRED in production. Comma-separated origins. Unset = blocked in prod, * in dev
MAX_COST=100                   # Default: 100. Monthly cost budget cap in USD. Set to 0 to disable
COST_PRICING_OVERRIDES=        # JSON override for model pricing, e.g. {"my-model":{"input":1,"output":5}}
CHUNK_SIZE_CHARS=2000          # Default: 2000. Characters per document chunk
CHUNK_OVERLAP_CHARS=200        # Default: 200. Overlap between chunks
NODE_ENV=production            # Default: production. Set to development for verbose logging
WORKER_CONCURRENCY=5           # Default: 5. BullMQ worker concurrency (ingestion-worker service)

# ─── Clerk Auth (Web + Admin + API) ─────────────
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY= # Clerk public key — web + admin apps
CLERK_SECRET_KEY=              # Clerk secret — API JWT verification + admin server-side
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in  # Optional: custom sign-in route
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up  # Optional: custom sign-up route

# ─── Web App (Vercel) ────────────────────────────
NEXT_PUBLIC_TURNSTILE_SITE_KEY= # Turnstile client key (§18)
NEXT_PUBLIC_POSTHOG_KEY=       # Product analytics (§21 Plane 2)
NEXT_PUBLIC_POSTHOG_HOST=      #
SENTRY_AUTH_TOKEN=             # Source map uploads

# ─── E2E Testing ────────────────────────────────
E2E_SKIP_SERVER=               # Set to '1' to skip auto-starting dev servers in Playwright E2E (CI uses pre-started servers)
E2E_API_URL=                   # Override API URL for E2E tests (default: http://localhost:3002)
E2E_WEB_URL=                   # Override web URL for E2E tests (default: http://localhost:3000)
E2E_ADMIN_URL=                 # Override admin URL for E2E tests (default: http://localhost:3001)

# ─── CI/CD (GitHub Secrets) ──────────────────────
LITELLM_PROXY_URL=             # Promptfoo evals against LiteLLM (§9)
LITELLM_API_KEY=               # Auth for LiteLLM in CI
GITGUARDIAN_API_KEY=           # Secret scanning (§7)

# ─── PostHog Server-Side (§22 Prompt A/B) ───────
POSTHOG_SERVER_API_KEY=        # Server-side PostHog
POSTHOG_HOST=                  # PostHog host URL
POSTHOG_PERSONAL_API_KEY=      # Local flag evaluation (optional)

# ─── Tier 2 Tools (Growth Stage, §20) ───────────
CRAWL4AI_URL=                  # Default: http://localhost:8000. Crawl4AI web scraping service URL
DEEPGRAM_API_KEY=              # Audio transcription (Deepgram)
UNSTRUCTURED_API_KEY=          # Document parsing (Unstructured.io)
UNSTRUCTURED_API_URL=          # Unstructured API endpoint URL
ZEROX_MODEL=gpt-4o-mini        # Vision LLM model for image OCR (requires OPENAI_API_KEY)
ZEROX_ENABLED=true             # Default: true. Enable Zerox vision-LLM OCR
TESSERACT_ENABLED=true         # Default: true. Enable Tesseract WASM OCR (free fallback)
COMPOSIO_API_KEY=              # Agent tool integrations (Composio)
MEMORY_PROVIDER=               # Options: mem0 | zep. No default — memory features disabled if unset
MEM0_API_KEY=                  # Mem0 preference graphs
MEM0_ORG_ID=                   # Mem0 organization
ZEP_API_KEY=                   # Zep temporal knowledge graphs
ZEP_BASE_URL=                  # Zep server URL
ROUTELLM_ENABLED=false         # Default: false. Enable ML-based model routing (requires RouteLLM model)
OPENPIPE_API_KEY=              # Fine-tuning pipeline (OpenPipe)
STRATEGY_PROVIDER_MODE=        # Default: strict in production, open in dev
STRATEGY_PROVIDER_ALLOW_OPEN_IN_PRODUCTION= # Break-glass: set to 'true' to allow open mode in production

# ─── Output Guardrails (§21) ─────────────────────
LLAMAGUARD_MODEL=llamaguard    # Default: llamaguard. LiteLLM alias. Guardrails skip if model unavailable
LLAMAGUARD_FAILURE_MODE=open   # Default: open. 'open' skips guardrail on failure, 'closed' blocks output
TOGETHER_AI_API_KEY=           # Together AI — hosts LlamaGuard model

# ─── Strapi CMS (Docker Compose) ───────────────
STRAPI_APP_KEYS=               # Comma-separated app keys (auto-generated if empty)
STRAPI_ADMIN_JWT_SECRET=       # Admin JWT secret (auto-generated if empty)
STRAPI_API_TOKEN_SALT=         # API token salt (auto-generated if empty)
STRAPI_TRANSFER_TOKEN_SALT=    # Transfer token salt (auto-generated if empty)
STRAPI_PORT=1337               # CMS port (default 1337)

# ─── Strategy Flywheel (CI workflow) ─────────────
API_URL=                       # Production API URL for flywheel runner (GitHub Actions secret)
API_KEY=                       # API key for flywheel runner (GitHub Actions secret)
DRY_RUN=                       # Set to 'true' to preview flywheel steps without writing
FLYWHEEL_TASK_TYPES=           # Comma-separated task types (default: summarization,classification)
FLYWHEEL_USER_IDS=             # Optional user IDs. If empty, runner uses /api/preferences/infer-all
FLYWHEEL_MIN_QUALITY_SCORE=    # Default: 0.85. Min quality for few-shot selection
FLYWHEEL_BUILD_LIMIT=          # Default: 20. Max generations evaluated per task type
FLYWHEEL_INFER_ALL_LIMIT=      # Default: 100. Max users for infer-all
FLYWHEEL_INFER_MIN_FEEDBACK_COUNT= # Default: 3. Min feedback rows/user for infer-all
FLYWHEEL_REPORT_PATH=          # Output path for flywheel report JSON

# ─── Prompt Promotion Loop (CI workflow) ─────────
PROMOTION_PROMPT_NAMES=        # Required. Comma-separated prompt names to evaluate
PROMOTION_LOOKBACK_DAYS=       # Default: 7. Lookback window for live outcomes
PROMOTION_MIN_SAMPLES=         # Default: 20. Minimum samples before decision
PROMOTION_MIN_ACCEPTANCE_RATE= # Default: 0.75. Promote when >= threshold
PROMOTION_MIN_CONVERSION_RATE= # Default: 0.08. Promote when >= threshold
PROMOTION_ROLLBACK_MAX_ACCEPTANCE_RATE= # Default: 0.55. Rollback when below threshold
PROMOTION_ROLLBACK_MAX_CONVERSION_RATE= # Default: 0.02. Rollback when below threshold
PROMOTION_REPORT_PATH=         # Output path for prompt promotion report JSON

# ─── Tier 3 Tools (Scale, §9/§22) ───────────────
BRAINTRUST_API_KEY=            # CI/CD eval blocking (Braintrust)
QODO_API_KEY=                  # AI test generation (Qodo Cover)
GRETEL_API_KEY=                # Synthetic eval data (Gretel)
